<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lotto UK 6/59 ‚Äì Smart Generator</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 20px;
    max-width: 900px;
    margin: 0 auto;
  }
  h1 { font-size: 22px; margin: 0 0 12px; }
  .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: end; margin: 10px 0; }
  label { font-size: 14px; opacity: 0.9; display: block; margin-bottom: 6px; }
  input, select {
    padding: 10px;
    font-size: 16px;
    border-radius: 10px;
    border: 1px solid rgba(229,231,235,0.15);
    background: rgba(15,23,42,0.6);
    color: #e5e7eb;
    outline: none;
  }
  input { width: 110px; }
  select { min-width: 200px; }
  button {
    padding: 10px 14px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid rgba(229,231,235,0.15);
    background: rgba(255,255,255,0.06);
    color: #e5e7eb;
    cursor: pointer;
  }
  button.primary { background: rgba(16,185,129,0.18); }
  button.danger { background: rgba(239,68,68,0.15); }
  .panel {
    margin-top: 14px;
    padding: 14px;
    border-radius: 16px;
    border: 1px solid rgba(229,231,235,0.12);
    background: rgba(255,255,255,0.03);
  }
  .line { margin: 6px 0; font-size: 18px; }
  .muted { opacity: 0.75; font-size: 12px; margin-top: 12px; }
  .split { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 14px; }
  @media (max-width: 800px) { .split { grid-template-columns: 1fr; } }
  .saved-item {
    display: flex; justify-content: space-between; align-items: center;
    gap: 10px;
    padding: 10px 10px;
    border-radius: 12px;
    border: 1px solid rgba(229,231,235,0.12);
    background: rgba(0,0,0,0.12);
    margin: 8px 0;
  }
  .saved-item code { font-size: 14px; }
</style>
</head>
<body>

<h1>üéØ Lotto UK 6/59 ‚Äì Smart Generator</h1>

<div class="row">
  <div>
    <label>Ile linii?</label>
    <input type="number" id="count" value="10" min="1" max="50" />
  </div>

  <div>
    <label>Tryb</label>
    <select id="mode">
      <option value="balanced">Balanced (domy≈õlny)</option>
      <option value="antiBirthday">Anti-Birthday (mniej dzielenia)</option>
      <option value="maxSpread">Max Spread (minimalny overlap)</option>
    </select>
  </div>

  <button class="primary" onclick="generate()">Generuj</button>
  <button onclick="copyLines()">Kopiuj</button>
  <button onclick="saveCurrent()">Zapisz</button>
  <button onclick="loadMyNumbers()">Wczytaj moje liczby</button>
</div>

<div class="panel" style="margin-top:12px">
  <b>‚ÑπÔ∏è Opis tryb√≥w</b>
  <ul style="margin:8px 0 0 18px; line-height:1.5">
    <li>
      <b>Balanced</b> ‚Äì zr√≥wnowa≈ºony tryb domy≈õlny.
      Losowe linie z sensownym rozk≈Çadem liczb, bez popularnych schemat√≥w.
      Najlepszy wyb√≥r do codziennej gry.
    </li>
    <li>
      <b>Anti-Birthday</b> ‚Äì ogranicza liczby 1‚Äì31 i wymusza wiƒôcej wysokich liczb.
      Zmniejsza ryzyko dzielenia wygranej z innymi graczami.
    </li>
    <li>
      <b>Max Spread</b> ‚Äì maksymalny rozrzut i minimalne powt√≥rzenia miƒôdzy liniami.
      Najlepszy przy wiƒôkszej liczbie kupon√≥w.
    </li>
  </ul>
  <div class="muted" style="margin-top:8px">
    Uwaga: tryby nie przewidujƒÖ losowa≈Ñ ‚Äì optymalizujƒÖ spos√≥b gry i uk≈Çad liczb.
  </div>
</div>

<div class="split">
  <div class="panel">
    <div id="out" class="muted">Kliknij ‚ÄûGeneruj‚Äù albo ‚ÄûWczytaj moje liczby‚Äù.</div>
    <div class="muted">
      Uwaga: to nie przewiduje losowa≈Ñ ‚Äî optymalizuje uk≈Çad i unika typowych schemat√≥w.
    </div>
  </div>

  <div class="panel">
    <b>‚≠ê Zapisane</b>
    <div id="saved"></div>
    <div class="row" style="margin-top:10px;">
      <button class="danger" onclick="clearSaved()">Wyczy≈õƒá zapisane</button>
    </div>
  </div>
</div>

<script>
/** ====== Core helpers ====== **/
const N = 59;

/* === Moje liczby (minimalnie przebudowane) === */
const MY_NUMBERS = [5, 19, 21, 33, 34, 52];

function randomInt1toN() {
  return Math.floor(Math.random() * N) + 1;
}

function randomLine() {
  const set = new Set();
  while (set.size < 6) set.add(randomInt1toN());
  return [...set].sort((a,b)=>a-b);
}

function sum(line) { return line.reduce((a,b)=>a+b,0); }

function has3Consecutive(line) {
  for (let i=0;i<line.length-2;i++){
    if (line[i+1] === line[i]+1 && line[i+2] === line[i]+2) return true;
  }
  return false;
}

function overlap(a,b){
  let c=0;
  for (const x of a) if (b.includes(x)) c++;
  return c;
}

function spreadScore(line){
  const diffs = [];
  for (let i=1;i<line.length;i++) diffs.push(line[i]-line[i-1]);
  const min = line[0], max = line[5];
  return (max - min) + diffs.reduce((a,b)=>a+b,0);
}

/** ====== Mode rules ====== **/
function validLineByMode(line, mode){
  if (has3Consecutive(line)) return false;

  const s = sum(line);
  if (s < 120 || s > 230) return false;

  if (mode === "balanced") {
    const high = line.filter(n => n > 31).length;
    if (high < 2 || high > 4) return false;
    return true;
  }

  if (mode === "antiBirthday") {
    const high = line.filter(n => n > 31).length;
    if (high < 3) return false;

    const low = 6 - high;
    if (low > 3) return false;

    return true;
  }

  if (mode === "maxSpread") {
    const high = line.filter(n => n > 31).length;
    if (high < 2) return false;

    if ((line[5] - line[0]) < 28) return false;

    return true;
  }

  return true;
}

/** ====== Generation engine ====== **/
let lastGenerated = [];

function generate(){
  const target = Math.max(1, Math.min(50, +document.getElementById("count").value || 10));
  const mode = document.getElementById("mode").value;

  const lines = [];
  let attempts = 0;

  let maxOverlap = 2;
  if (mode === "maxSpread") maxOverlap = 1;
  if (target >= 20) maxOverlap = Math.min(2, maxOverlap + 1);

  while (lines.length < target && attempts < 50000) {
    let l = randomLine();
    if (!validLineByMode(l, mode)) { attempts++; continue; }

    if (lines.some(ex => overlap(ex, l) > maxOverlap)) {
      attempts++; continue;
    }

    if (mode === "maxSpread") {
      let best = l;
      let bestScore = spreadScore(l);
      for (let t=0; t<12; t++){
        const cand = randomLine();
        if (!validLineByMode(cand, mode)) continue;
        if (lines.some(ex => overlap(ex, cand) > maxOverlap)) continue;
        const sc = spreadScore(cand);
        if (sc > bestScore) { best = cand; bestScore = sc; }
      }
      l = best;
    }

    lines.push(l);
  }

  lastGenerated = lines;
  renderLines(lines, attempts, mode);
}

function loadMyNumbers() {
  lastGenerated = [MY_NUMBERS.slice().sort((a,b)=>a-b)];
  renderLines(lastGenerated, 0, "Moje liczby");
}

function renderLines(lines, attempts, mode){
  const out = document.getElementById("out");
  if (!lines.length){
    out.innerHTML = `<div class="muted">Nie uda≈Ço siƒô wygenerowaƒá linii (spr√≥buj mniejszƒÖ liczbƒô linii albo inny tryb). Pr√≥by: ${attempts}</div>`;
    return;
  }

  const modeName = ({
    balanced: "Balanced",
    antiBirthday: "Anti-Birthday",
    maxSpread: "Max Spread"
  })[mode] || mode;

  out.innerHTML = `
    <div class="muted">Tryb: <b>${modeName}</b> ‚Ä¢ Linie: <b>${lines.length}</b> ‚Ä¢ Pr√≥by: ${attempts}</div>
    ${lines.map((l,i)=>`<div class="line">${i+1}. ${l.join(" ‚Äì ")}</div>`).join("")}
  `;
}

/** ====== Copy ====== **/
async function copyLines(){
  if (!lastGenerated.length) { alert("Najpierw wygeneruj linie."); return; }
  const text = lastGenerated.map(l => l.join("-")).join("\n");
  try {
    await navigator.clipboard.writeText(text);
    alert("Skopiowano do schowka ‚úÖ");
  } catch(e){
    window.prompt("Skopiuj rƒôcznie:", text);
  }
}

/** ====== Save (localStorage) ====== **/
const LS_KEY = "lotto_saved_lines_v1";

function loadSaved(){
  try {
    const raw = localStorage.getItem(LS_KEY);
    return raw ? JSON.parse(raw) : [];
  } catch {
    return [];
  }
}

function storeSaved(items){
  localStorage.setItem(LS_KEY, JSON.stringify(items));
}

function saveCurrent(){
  if (!lastGenerated.length) { alert("Najpierw wygeneruj linie."); return; }
  const mode = document.getElementById("mode").value;
  const stamp = new Date().toISOString().slice(0,19).replace("T"," ");
  const payload = {
    id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random()),
    createdAt: stamp,
    mode,
    lines: lastGenerated
  };

  const items = loadSaved();
  items.unshift(payload);
  storeSaved(items.slice(0,20));
  renderSaved();
  alert("Zapisano ‚≠ê");
}

function deleteSaved(id){
  const items = loadSaved().filter(x => x.id !== id);
  storeSaved(items);
  renderSaved();
}

function clearSaved(){
  if (!confirm("Wyczy≈õciƒá wszystkie zapisane zestawy?")) return;
  localStorage.removeItem(LS_KEY);
  renderSaved();
}

function renderSaved(){
  const wrap = document.getElementById("saved");
  const items = loadSaved();

  if (!items.length){
    wrap.innerHTML = `<div class="muted">Brak zapisanych zestaw√≥w.</div>`;
    return;
  }

  const modeName = (m) => ({
    balanced: "Balanced",
    antiBirthday: "Anti-Birthday",
    maxSpread: "Max Spread"
  })[m] || m;

  wrap.innerHTML = items.map(item => {
    const oneLine = item.lines.map(l => l.join("-")).join(" | ");
    return `
      <div class="saved-item">
        <div>
          <div style="font-size:12px; opacity:.8">${item.createdAt} ‚Ä¢ ${modeName(item.mode)}</div>
          <code>${oneLine}</code>
        </div>
        <button class="danger" onclick="deleteSaved('${item.id}')">Usu≈Ñ</button>
      </div>
    `;
  }).join("");
}

renderSaved();
</script>

</body>
</html>
